package environment {
    import flash.net.URLRequest;
    import flash.display.Loader;
    import flash.events.Event;
    import flash.events.ProgressEvent;
    import flash.display.MovieClip;

    public class SwfLoader {
        private var mLoader:Loader = new Loader();
        private var mRequest:URLRequest;
        private var fileQ:Array = [];
        private var swfs:Array = [];
        private var swfsIndex:Array = [];
        private var totalFiles:int = 0;
        private var loadedFiles:int = 0;
        private var callback:Function;

        public function SwfLoader() {
        }

        public function setCallback(callback:Function):void {
            this.callback = callback;
        }

        public function addFile(filename:String):void {
            this.fileQ.push(filename);
            this.totalFiles++;
        }

        public function loadFile(filename:String):void {
            this.addFile(filename);
            this.load();
        }

        public function load():void {
            var self = this,
                url = fileQ[0];

            if ( fileQ.length === 0 ) {
                return;
            }

            this.mRequest = new URLRequest();
            
            this.mLoader.contentLoaderInfo.addEventListener(Event.COMPLETE, function(loadEvent:Event){ 
                self.addSwf(url, MovieClip(loadEvent.currentTarget.content));
            });
            
            this.mLoader.load(mRequest);
        }

        public function getClip(index:*):void {
        }

        public function getIndex(index:*):void {
            if ( typeof(index) === "number" ) {
                return index;
            }
            else if ( typeof(index) ) {
                return returnthis.swfsIndex.indexOf(index);
            }
        }

        private function onProgressHandler(mProgress:ProgressEvent) {
            var percent:Number = mProgress.bytesLoaded/mProgress.bytesTotal;
        }

        private function addSwf(url:String, swf:MovieClip):MovieClip {
            var urls:Array = url.split('/');
            var file:String = urls[urls.length - 1].replace(/\..*$/, '');

            this.fileQ.shift();
            this.swfs.push(swf);
            this.swfsIndex.push(file);
            this.loadedFiles++;
            this.load();

            if( this.callback['call'] ) {
                this.callback.call(this, file);
            }
        }
    }
}
